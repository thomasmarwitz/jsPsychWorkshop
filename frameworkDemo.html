<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsPsych Demo</title>
    <script src="jspsych-6.2.0/jspsych.js"></script>
    <link href="jspsych-6.2.0/css/jspsych.css" rel="stylesheet" type="text/css">
    <!--Plugins-->
    <script src="jspsych-6.2.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.2.0/plugins/jspsych-html-button-response.js"></script>
</head>
<body></body>
<script>

    // question
    const choice = {
        type: "html-button-response", 
        stimulus: "<p>WÃ¤hle weise:</p>",
        choices: ["red pill", "blue pill"],
        data: {test_part: "question"}
    }

    // the answer
    const answer = {
        type: "html-keyboard-response",
        stimulus: () => {
            if (jsPsych.data.get().filter({test_part: "question"}).last().values()[0]?.button_pressed == 1) { // blue pill
                return "<p>Unwissen ist auch ein Segen...</p>"
            } else {
                return "<p>Willkommen in Zion, Neo!</p>"
            }
        },
        trial_duration: 3000,
        choices: jsPsych.NO_KEYS,

    }

    // keep him inside
    const matrixLoop = {
        timeline: [choice, answer],
        loop_function: () => {
            return jsPsych.data.get().filter({test_part: "question"}).last().values()[0]?.button_pressed == 1 // blue pill
        }    
    }

    // start the matrix
    jsPsych.init({
        timeline: [matrixLoop, {
            type: "html-keyboard-response",
            stimulus: "Ende der <i>Simulation</i>",
            on_start: () => {
                setTimeout(() => {alert("oder doch nicht?")}, 5000)
            }
        }]
    })


</script>
</html>