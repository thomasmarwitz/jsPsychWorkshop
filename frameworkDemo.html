<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsPsych Demo</title>
    <script src="jspsych-6.2.0/jspsych.js"></script>
    <link href="jspsych-6.2.0/css/jspsych.css" rel="stylesheet" type="text/css">
    <!--Plugins-->
    <script src="jspsych-6.2.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.2.0/plugins/jspsych-html-button-response.js"></script>
</head>
<body></body>
<script>

    const btnChoices = ["red pill", "blue pill"]

    // question
    const choice = {
        type: "html-button-response", 
        stimulus: "<p>WÃ¤hle weise:</p>",
        choices: btnChoices,
        data: {test_part: "question"}
    }

    function getQuestion() {
        return jsPsych.data.get().filter({test_part: "question"})
    }

    function getLastTrialValues() {
        return getQuestion().last().values()[0] // indexmagie
    }

    function getAnswer() {
        const btnChoicesIndex = getLastTrialValues().button_pressed// 0 oder 1
        return btnChoices[btnChoicesIndex]
    }

    // the answer
    const answer = {
        type: "html-keyboard-response",
        stimulus: () => {
            if (getAnswer() == "blue pill") {
                return "<p>Unwissen ist auch ein Segen...</p>"
            } else {
                return "<p>Willkommen in Zion, Neo!</p>"
            }
        },
        trial_duration: 12000,
        choices: jsPsych.NO_KEYS,

    }

    // keep him inside
    const matrixLoop = {
        timeline: [choice, answer],
        loop_function: () => {
            return getAnswer() == "blue pill" // blue pill
        }    
    }

    const trialEnd = {
        type: "html-keyboard-response",
        stimulus: "Ende der <i>Simulation</i>",
        on_start: () => {
            setTimeout(
                () => {alert("oder doch nicht?")}, 5000
            )
        }
    }


    // start the matrix
    jsPsych.init({
        timeline: [matrixLoop, trialEnd]
    })


</script>
</html>